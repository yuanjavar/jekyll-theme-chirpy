---
layout: post
title: 如何保持 mysql 和 redis 的数据一致性？
category: 面试
tags: [面试]
description: 如何保持 mysql 和 redis 的数据一致性？
keywords: 数据一致性, 强一致性, 最终一致性, mysql, redis, mysql和redis数据一致性
excerpt: 接口隔离原则是什么？怎么使用接口隔离原则？
---

你好，我是Weiki，欢迎来到猿java。

如何保证缓存和数据库一致性，这已经是一个老生常谈的话题，网上关于这块的帖子也是一大堆，为什么还要重复造轮子？个人看过很多优秀的帖子，但是感觉还是没有讲透，因此重新总结了一遍。
在介绍"如何保持mysql和redis中数据的⼀致性"这个问题之前，需要先弄清"什么是数据⼀致性"，"一致性的等级有哪些"，以及"什么情况下会出现数据一致性" 这3个问题，只有知道了原因，才能对症下药，寻找更好的解决办法。

## 什么是数据一致性以及出现的原因

首先需要明白一点，当数据只存放一份时，是不会存在数据一致性问题。

所以，数据一致性是指相同的数据要保存成多份时，如果不能保证所有的数据都完全相同，就会出现数据一致性问题。

怎么理解这句话呢？ 注意措辞，这里强调的是**份**，那么多份数据可以怎么存放呢？

**存放在1个载体**

比如，相同的数据保存在同一个数据库的多张表中，如下图： 当服务器要把同一份数据写入A表成功，B表失败时，这时就会出现数据不一致

![img.png](../../assets/md/mysql/one-db-two-table.png)

**存放在多个载体**

比如，当服务器把同一份数据写入DB1的A表成功，写入DB2的B表失败时，这时也出现了数据不一致

![img.png](../../assets/md/mysql/two-db-two-table.png)

当服务器把同一份数据写入DB成功，写入redis失败时，也会出现了数据不一致

![img.png](../../assets/md/mysql/redis-mysql.png)

更抽象一些，当服务器把同一份数据写入载体1~载体n成功，只要有一个失败，就会出现了数据不一致

![img.png](../../assets/md/mysql/multi-way.png)

通过上面的描述我们知道了什么是数据一致性，什么时候会存现数据一致性问题，因此mysql和redis数据的⼀致性就是指：同一份数据写入mysql和redis后，redis中的值 ≠ mysql中的值。

## 数据一致性有哪些等级

**强一致性**

强一致性，也可以叫做 原子一致性或者线性一致性，它是由Herlihy 和 Wing 于1987年在论文 [Axioms for Concurrent Objects](http://www.cs.cmu.edu/~wing/publications/HerlihyWing87a.pdf) 中提出的。它是一种重要的数据模型，
何为强一致性，简而言之，在任意时刻，所有载体上的数据都是一样的。


**顺序一致性**


**最终一致性**

最终一致性是指中间某个时间点，同一份数据在任何一个节点都能完全相同，但是随着时间的推移，终究存在一个时间点，所得所有的节点数据都相同，达到最终一致。


## 总结

一致性的场景并不是只是分布式系统，单体服务一样会出现。

做接口设计时，需要关注不同的使用者，不能只关注设计者。

大而全的接口不一定是好接口。


## 最后
如果你觉得本文章对你有帮助，感谢转发给更多的好友，我们将为你呈现更多的干货， 欢迎关注公众号：猿java

